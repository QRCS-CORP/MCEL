\doxysection{udil.\+h}
\hypertarget{udil_8h_source}{}\label{udil_8h_source}\index{C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/MCEL/MCEL/Saved/udil.h@{C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/MCEL/MCEL/Saved/udil.h}}
\mbox{\hyperlink{udil_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ 2025-\/2026\ Quantum\ Resistant\ Cryptographic\ Solutions\ Corporation}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ All\ Rights\ Reserved.}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ NOTICE:}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ software\ and\ all\ accompanying\ materials\ are\ the\ exclusive\ property\ of}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ Quantum\ Resistant\ Cryptographic\ Solutions\ Corporation\ (QRCS).\ The\ intellectual}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ and\ technical\ concepts\ contained\ herein\ are\ proprietary\ to\ QRCS\ and\ are}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ protected\ under\ applicable\ Canadian,\ U.S.,\ and\ international\ copyright,}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ patent,\ and\ trade\ secret\ laws.}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ CRYPTOGRAPHIC\ ALGORITHMS\ AND\ IMPLEMENTATIONS:}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ -\/\ This\ software\ includes\ implementations\ of\ cryptographic\ primitives\ and}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ \ \ algorithms\ that\ are\ standardized\ or\ in\ the\ public\ domain,\ such\ as\ AES}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ \ \ and\ SHA-\/3,\ which\ are\ not\ proprietary\ to\ QRCS.}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ -\/\ This\ software\ also\ includes\ cryptographic\ primitives,\ constructions,\ and}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *\ \ \ algorithms\ designed\ by\ QRCS,\ including\ but\ not\ limited\ to\ RCS,\ SCB,\ CSX,\ QMAC,\ and}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ \ \ related\ components,\ which\ are\ proprietary\ to\ QRCS.}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ -\/\ All\ source\ code,\ implementations,\ protocol\ compositions,\ optimizations,}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ \ \ parameter\ selections,\ and\ engineering\ work\ contained\ in\ this\ software\ are}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ \ \ original\ works\ of\ QRCS\ and\ are\ protected\ under\ this\ license.}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ LICENSE\ AND\ USE\ RESTRICTIONS:}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ -\/\ This\ software\ is\ licensed\ under\ the\ Quantum\ Resistant\ Cryptographic\ Solutions}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ \ \ Public\ Research\ and\ Evaluation\ License\ (QRCS-\/PREL),\ 2025-\/2026.}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ -\/\ Permission\ is\ granted\ solely\ for\ non-\/commercial\ evaluation,\ academic\ research,}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *\ \ \ cryptographic\ analysis,\ interoperability\ testing,\ and\ feasibility\ assessment.}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *\ -\/\ Commercial\ use,\ production\ deployment,\ commercial\ redistribution,\ or}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ *\ \ \ integration\ into\ products\ or\ services\ is\ strictly\ prohibited\ without\ a}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ *\ \ \ separate\ written\ license\ agreement\ executed\ with\ QRCS.}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ *\ -\/\ Licensing\ and\ authorized\ distribution\ are\ solely\ at\ the\ discretion\ of\ QRCS.}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *\ EXPERIMENTAL\ CRYPTOGRAPHY\ NOTICE:}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ *\ Portions\ of\ this\ software\ may\ include\ experimental,\ novel,\ or\ evolving}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ *\ cryptographic\ designs.\ Use\ of\ this\ software\ is\ entirely\ at\ the\ user's\ risk.}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *\ DISCLAIMER:}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ *\ THIS\ SOFTWARE\ IS\ PROVIDED\ "{}AS\ IS"{},\ WITHOUT\ WARRANTY\ OF\ ANY\ KIND,\ EXPRESS\ OR}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ *\ IMPLIED,\ INCLUDING\ BUT\ NOT\ LIMITED\ TO\ WARRANTIES\ OF\ MERCHANTABILITY,\ FITNESS}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ *\ FOR\ A\ PARTICULAR\ PURPOSE,\ SECURITY,\ OR\ NON-\/INFRINGEMENT.\ QRCS\ DISCLAIMS\ ALL}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ *\ LIABILITY\ FOR\ ANY\ DIRECT,\ INDIRECT,\ INCIDENTAL,\ OR\ CONSEQUENTIAL\ DAMAGES}}
\DoxyCodeLine{00041\ \textcolor{comment}{\ *\ ARISING\ FROM\ THE\ USE\ OR\ MISUSE\ OF\ THIS\ SOFTWARE.}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ *\ FULL\ LICENSE:}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ *\ This\ software\ is\ subject\ to\ the\ Quantum\ Resistant\ Cryptographic\ Solutions}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ Public\ Research\ and\ Evaluation\ License\ (QRCS-\/PREL),\ 2025-\/2026.\ The\ complete\ license\ terms}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *\ are\ provided\ in\ the\ accompanying\ LICENSE\ file\ or\ at\ https://www.qrcscorp.ca.}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ Written\ by:\ John\ G.\ Underhill}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ Contact:\ contact\(\backslash\)qrcscorp.ca}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#ifndef\ UDIL\_H}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#define\ UDIL\_H}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#include\ "{}udilcommon.h"{}}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{comment}{//\#define\ UDIL\_HASHLEN\ 32}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\#define\ MAX\_DEPTH\ 64}}
\DoxyCodeLine{00109\ \textcolor{comment}{//}}
\DoxyCodeLine{00110\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_CHK[]\ =\ "{}UDIL/CHK"{};}}
\DoxyCodeLine{00111\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_ENV[]\ =\ "{}UDIL/ENV"{};}}
\DoxyCodeLine{00112\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_ID[]\ =\ "{}UDIL/ID"{};}}
\DoxyCodeLine{00113\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_LEAF[]\ =\ "{}UDIL/LEAF"{};}}
\DoxyCodeLine{00114\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_NODE[]\ =\ "{}UDIL/NODE"{};}}
\DoxyCodeLine{00115\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_PAY[]\ =\ "{}UDIL/PAY"{};}}
\DoxyCodeLine{00116\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_REC[]\ =\ "{}UDIL/REC"{};}}
\DoxyCodeLine{00117\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_SIG\_CHK[]\ =\ "{}UDIL/SIG/CHK"{};}}
\DoxyCodeLine{00118\ \textcolor{comment}{//static\ const\ uint8\_t\ TAG\_SIG\_REC[]\ =\ "{}UDIL/SIG/REC"{};}}
\DoxyCodeLine{00119\ \textcolor{comment}{//}}
\DoxyCodeLine{00120\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ enum}}
\DoxyCodeLine{00121\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00122\ \textcolor{comment}{//\ \ \ \ RTYPE\_MESSAGE\ =\ 0x0001,}}
\DoxyCodeLine{00123\ \textcolor{comment}{//\ \ \ \ RTYPE\_ACK\ =\ 0x0002,}}
\DoxyCodeLine{00124\ \textcolor{comment}{//\ \ \ \ RTYPE\_NACK\ =\ 0x0003,}}
\DoxyCodeLine{00125\ \textcolor{comment}{//\ \ \ \ RTYPE\_RECEIPT\ =\ 0x0004,}}
\DoxyCodeLine{00126\ \textcolor{comment}{//\ \ \ \ RTYPE\_ADMIN\ =\ 0x0005,}}
\DoxyCodeLine{00127\ \textcolor{comment}{//\ \ \ \ RTYPE\_CHECKPOINT\ =\ 0x0006,}}
\DoxyCodeLine{00128\ \textcolor{comment}{//\ \ \ \ RTYPE\_ANCHOR\_REF\ =\ 0x0007}}
\DoxyCodeLine{00129\ \textcolor{comment}{//\}\ udil\_record\_type;}}
\DoxyCodeLine{00130\ \textcolor{comment}{//}}
\DoxyCodeLine{00131\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_anchor\_ref}}
\DoxyCodeLine{00132\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00133\ \textcolor{comment}{//\ \ \ \ uint16\_t\ version;}}
\DoxyCodeLine{00134\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ chk\_commit[UDIL\_HASHLEN];}}
\DoxyCodeLine{00135\ \textcolor{comment}{//\ \ \ \ uint16\_t\ anchor\_type;\ \ \ \ \ //\ 1=consortium,\ 2=regulator,\ 3=provenance-\/pillar}}
\DoxyCodeLine{00136\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ anchor\_id[32];\ \ \ //\ for\ example\ txid\ hash,\ receipt\ id\ hash}}
\DoxyCodeLine{00137\ \textcolor{comment}{//\ \ \ \ uint64\_t\ anchored\_time;}}
\DoxyCodeLine{00138\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ reserved[16];}}
\DoxyCodeLine{00139\ \textcolor{comment}{//\}\ udil\_anchor\_ref;}}
\DoxyCodeLine{00140\ \textcolor{comment}{//}}
\DoxyCodeLine{00141\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_merkle\_proof}}
\DoxyCodeLine{00142\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00143\ \textcolor{comment}{//\ \ \ \ uint8\_t\ siblings[MAX\_DEPTH][UDIL\_HASHLEN];}}
\DoxyCodeLine{00144\ \textcolor{comment}{//\ \ \ \ uint8\_t\ directions[MAX\_DEPTH];}}
\DoxyCodeLine{00145\ \textcolor{comment}{//\ \ \ \ size\_t\ depth;}}
\DoxyCodeLine{00146\ \textcolor{comment}{//\}\ udil\_merkle\_proof;}}
\DoxyCodeLine{00147\ \textcolor{comment}{//}}
\DoxyCodeLine{00148\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_envelope}}
\DoxyCodeLine{00149\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00150\ \textcolor{comment}{//\ \ \ \ uint16\_t\ version;}}
\DoxyCodeLine{00151\ \textcolor{comment}{//\ \ \ \ uint16\_t\ msg\_type;}}
\DoxyCodeLine{00152\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ sender\_id[UDIL\_HASHLEN];}}
\DoxyCodeLine{00153\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ receiver\_id[UDIL\_HASHLEN];}}
\DoxyCodeLine{00154\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ corr\_id[16];}}
\DoxyCodeLine{00155\ \textcolor{comment}{//\ \ \ \ uint64\_t\ time;}}
\DoxyCodeLine{00156\ \textcolor{comment}{//\ \ \ \ uint64\_t\ valid\_until;}}
\DoxyCodeLine{00157\ \textcolor{comment}{//\}\ udil\_envelope;}}
\DoxyCodeLine{00158\ \textcolor{comment}{//}}
\DoxyCodeLine{00159\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_record\_hdr}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ \ \ \ uint16\_t\ version;}}
\DoxyCodeLine{00162\ \textcolor{comment}{//\ \ \ \ uint16\_t\ rtype;}}
\DoxyCodeLine{00163\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ ledger\_id[UDIL\_HASHLEN];}}
\DoxyCodeLine{00164\ \textcolor{comment}{//\ \ \ \ uint32\_t\ epoch;}}
\DoxyCodeLine{00165\ \textcolor{comment}{//\ \ \ \ uint64\_t\ seq;}}
\DoxyCodeLine{00166\ \textcolor{comment}{//\ \ \ \ uint64\_t\ time;}}
\DoxyCodeLine{00167\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ prev\_hash[UDIL\_HASHLEN];}}
\DoxyCodeLine{00168\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ env\_hash[UDIL\_HASHLEN];}}
\DoxyCodeLine{00169\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ pay\_hash[UDIL\_HASHLEN];}}
\DoxyCodeLine{00170\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ corr\_id[16];}}
\DoxyCodeLine{00171\ \textcolor{comment}{//\ \ \ \ uint32\_t\ flags;}}
\DoxyCodeLine{00172\ \textcolor{comment}{//\}\ udil\_record\_hdr;}}
\DoxyCodeLine{00173\ \textcolor{comment}{//}}
\DoxyCodeLine{00174\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_checkpoint\_body}}
\DoxyCodeLine{00175\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00176\ \textcolor{comment}{//\ \ \ \ uint16\_t\ body\_version;}}
\DoxyCodeLine{00177\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ ledger\_id[UDIL\_HASHLEN];}}
\DoxyCodeLine{00178\ \textcolor{comment}{//\ \ \ \ uint32\_t\ epoch;}}
\DoxyCodeLine{00179\ \textcolor{comment}{//\ \ \ \ uint64\_t\ start\_seq;}}
\DoxyCodeLine{00180\ \textcolor{comment}{//\ \ \ \ uint64\_t\ end\_seq;}}
\DoxyCodeLine{00181\ \textcolor{comment}{//\ \ \ \ uint32\_t\ record\_count;}}
\DoxyCodeLine{00182\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ batch\_root[UDIL\_HASHLEN];}}
\DoxyCodeLine{00183\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ prev\_checkpoint\_commit[UDIL\_HASHLEN];}}
\DoxyCodeLine{00184\ \textcolor{comment}{//\ \ \ \ uint64\_t\ created\_time;}}
\DoxyCodeLine{00185\ \textcolor{comment}{//\ \ \ \ uint32\_t\ flags;}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ reserved[16];}}
\DoxyCodeLine{00187\ \textcolor{comment}{//\}\ udil\_checkpoint\_body;}}
\DoxyCodeLine{00188\ \textcolor{comment}{//}}
\DoxyCodeLine{00189\ \textcolor{comment}{//UDIL\_EXPORT\_API\ typedef\ struct\ udil\_ledger\_state}}
\DoxyCodeLine{00190\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ ledger\_id[UDIL\_HASHLEN];}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ \ \ \ uint32\_t\ epoch;}}
\DoxyCodeLine{00193\ \textcolor{comment}{//\ \ \ \ uint64\_t\ head\_seq;}}
\DoxyCodeLine{00194\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ head\_hash[UDIL\_HASHLEN];}}
\DoxyCodeLine{00195\ \textcolor{comment}{//\ \ \ \ uint64\_t\ last\_checkpoint\_end\_seq;}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ \ \ \ uint8\_t\ \ last\_checkpoint\_commit[UDIL\_HASHLEN];}}
\DoxyCodeLine{00197\ \textcolor{comment}{//\ \ \ \ void*\ udif\_signing\_key;}}
\DoxyCodeLine{00198\ \textcolor{comment}{//\ \ \ \ void*\ store;}}
\DoxyCodeLine{00199\ \textcolor{comment}{//\}\ udil\_ledger\_state;}}
\DoxyCodeLine{00200\ \textcolor{comment}{//}}
\DoxyCodeLine{00201\ \textcolor{comment}{//}}
\DoxyCodeLine{00202\ \textcolor{comment}{//int32\_t\ store\_append(void*\ store,\ const\ uint8\_t*\ bytes,\ size\_t\ len);}}
\DoxyCodeLine{00203\ \textcolor{comment}{//int32\_t\ store\_read\_by\_seq(void*\ store,\ uint64\_t\ seq,\ uint8\_t**\ out\_bytes,\ size\_t*\ out\_len);}}
\DoxyCodeLine{00204\ \textcolor{comment}{//int32\_t\ store\_read\_range(void*\ store,\ uint64\_t\ start\_seq,\ uint64\_t\ end\_seq,}}
\DoxyCodeLine{00205\ \textcolor{comment}{//\ \ \ \ uint8\_t***\ out\_records,\ size\_t**\ out\_lens,\ size\_t*\ out\_count);}}
\DoxyCodeLine{00206\ \textcolor{comment}{//int32\_t\ store\_get\_head(void*\ store,\ uint64\_t*\ out\_head\_seq,\ uint8\_t\ out\_head\_hash[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00207\ \textcolor{comment}{//int32\_t\ store\_set\_head(void*\ store,\ uint64\_t\ head\_seq,\ const\ uint8\_t\ head\_hash[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00208\ \textcolor{comment}{//int32\_t\ store\_find\_last\_checkpoint(void*\ store,\ uint8\_t\ out\_chk\_commit[UDIL\_HASHLEN],\ uint64\_t*\ out\_end\_seq);}}
\DoxyCodeLine{00209\ \textcolor{comment}{//}}
\DoxyCodeLine{00210\ \textcolor{comment}{//}}
\DoxyCodeLine{00212\ \textcolor{comment}{//\ *\ Detect\ equivocation\ between\ two\ checkpoints\ (same\ ledger/epoch,\ overlapping}}
\DoxyCodeLine{00213\ \textcolor{comment}{//\ *\ range,\ different\ roots\ or\ commitments).}}
\DoxyCodeLine{00214\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00215\ \textcolor{comment}{//\ *\ Returns:}}
\DoxyCodeLine{00216\ \textcolor{comment}{//\ *\ \ \ 1\ if\ equivocation\ is\ detected,\ 0\ otherwise.}}
\DoxyCodeLine{00217\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00218\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_audit\_detect\_equivocation(const\ udil\_checkpoint\_body*\ a,\ const\ uint8\_t\ a\_commit[UDIL\_HASHLEN],}}
\DoxyCodeLine{00219\ \textcolor{comment}{//\ \ \ \ const\ udil\_checkpoint\_body*\ b,\ const\ uint8\_t\ b\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00220\ \textcolor{comment}{//}}
\DoxyCodeLine{00222\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Verify\ that\ a\ record\ commitment\ is\ included\ in\ a\ checkpoint\ Merkle\ root\ (sample\ audit).}}
\DoxyCodeLine{00223\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00224\ \textcolor{comment}{//\ *\ This\ function\ is\ used\ by\ auditors\ and\ counterparties\ to\ validate\ that\ a\ given}}
\DoxyCodeLine{00225\ \textcolor{comment}{//\ *\ record\ commitment\ was\ incorporated\ into\ a\ checkpointed\ batch\ without\ requiring}}
\DoxyCodeLine{00226\ \textcolor{comment}{//\ *\ access\ to\ the\ full\ ledger\ or\ plaintext\ message\ content.}}
\DoxyCodeLine{00227\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00228\ \textcolor{comment}{//\ *\ The\ verifier\ recomputes\ the\ Merkle\ root\ from\ the\ provided\ record\ commitment}}
\DoxyCodeLine{00229\ \textcolor{comment}{//\ *\ and\ Merkle\ proof,\ then\ compares\ it\ to\ the\ expected\ checkpoint\ root.}}
\DoxyCodeLine{00230\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00231\ \textcolor{comment}{//\ *\ \(\backslash\)param\ checkpoint\_root\ \ The\ expected\ 32-\/byte\ Merkle\ root\ committed\ by\ a\ checkpoint.}}
\DoxyCodeLine{00232\ \textcolor{comment}{//\ *\ \(\backslash\)param\ rec\_commit\ \ \ \ \ \ \ The\ 32-\/byte\ record\ commitment\ being\ proven\ included.}}
\DoxyCodeLine{00233\ \textcolor{comment}{//\ *\ \(\backslash\)param\ proof\ \ \ \ \ \ \ \ \ \ \ \ The\ Merkle\ inclusion\ proof\ for\ rec\_commit\ under\ checkpoint\_root.}}
\DoxyCodeLine{00234\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00235\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success\ (proof\ verifies\ and\ matches\ checkpoint\_root),\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00236\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00237\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_audit\_sample\_inclusion(const\ uint8\_t\ checkpoint\_root[UDIL\_HASHLEN],\ const\ uint8\_t\ rec\_commit[UDIL\_HASHLEN],\ const\ udil\_merkle\_proof*\ proof);}}
\DoxyCodeLine{00238\ \textcolor{comment}{//}}
\DoxyCodeLine{00239\ \textcolor{comment}{//\ /**}}
\DoxyCodeLine{00240\ \textcolor{comment}{//\ \ *\ Compute\ the\ checkpoint\ commitment\ from\ a\ checkpoint\ body.}}
\DoxyCodeLine{00241\ \textcolor{comment}{//\ \ *}}
\DoxyCodeLine{00242\ \textcolor{comment}{//\ \ *\ chk\_commit\ =\ SHAKE256("{}UDIL/CHK"{}\ ||\ SER(checkpoint\_body),\ 32)}}
\DoxyCodeLine{00243\ \textcolor{comment}{//\ \ *}}
\DoxyCodeLine{00244\ \textcolor{comment}{//\ \ *\ out\ \ :\ [out]\ 32-\/byte\ checkpoint\ commitment.}}
\DoxyCodeLine{00245\ \textcolor{comment}{//\ \ *\ body\ :\ [in]\ \ checkpoint\ body.}}
\DoxyCodeLine{00246\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00247\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_compute\_checkpoint\_commit(uint8\_t\ out[UDIL\_HASHLEN],\ const\ udil\_checkpoint\_body*\ body);}}
\DoxyCodeLine{00248\ \textcolor{comment}{//}}
\DoxyCodeLine{00250\ \textcolor{comment}{//\ *\ Compute\ the\ domain-\/separated\ envelope\ hash.}}
\DoxyCodeLine{00251\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00252\ \textcolor{comment}{//\ *\ The\ envelope\ hash\ commits\ to\ the\ canonical\ envelope\ bytes\ (message\ metadata).}}
\DoxyCodeLine{00253\ \textcolor{comment}{//\ *\ This\ is\ used\ to\ prove\ message\ identity\ without\ storing\ full\ payload\ content.}}
\DoxyCodeLine{00254\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00255\ \textcolor{comment}{//\ *\ out\ \ \ \ :\ [out]\ 32-\/byte\ hash\ output.}}
\DoxyCodeLine{00256\ \textcolor{comment}{//\ *\ env\ \ \ \ :\ [in]\ \ canonical\ envelope\ bytes.}}
\DoxyCodeLine{00257\ \textcolor{comment}{//\ *\ envlen\ :\ [in]\ \ number\ of\ envelope\ bytes.}}
\DoxyCodeLine{00258\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00259\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_compute\_env\_hash(uint8\_t\ out[UDIL\_HASHLEN],\ const\ uint8\_t*\ env,\ size\_t\ envlen);}}
\DoxyCodeLine{00260\ \textcolor{comment}{//}}
\DoxyCodeLine{00262\ \textcolor{comment}{//\ *\ Compute\ the\ domain-\/separated\ payload\ hash.}}
\DoxyCodeLine{00263\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00264\ \textcolor{comment}{//\ *\ The\ payload\ hash\ commits\ to\ the\ payload\ bytes\ or\ ciphertext\ bytes\ (if\ encrypted).}}
\DoxyCodeLine{00265\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00266\ \textcolor{comment}{//\ *\ out\ \ \ \ :\ [out]\ 32-\/byte\ hash\ output.}}
\DoxyCodeLine{00267\ \textcolor{comment}{//\ *\ pay\ \ \ \ :\ [in]\ \ payload\ bytes.}}
\DoxyCodeLine{00268\ \textcolor{comment}{//\ *\ paylen\ :\ [in]\ \ number\ of\ payload\ bytes.}}
\DoxyCodeLine{00269\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00270\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_compute\_payload\_hash(uint8\_t\ out[UDIL\_HASHLEN],\ const\ uint8\_t*\ pay,\ size\_t\ paylen);}}
\DoxyCodeLine{00271\ \textcolor{comment}{//}}
\DoxyCodeLine{00273\ \textcolor{comment}{//\ *\ Compute\ the\ record\ commitment\ for\ a\ record\ header.}}
\DoxyCodeLine{00274\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00275\ \textcolor{comment}{//\ *\ rec\_commit\ =\ SHAKE256("{}UDIL/REC"{}\ ||\ SER(record\_hdr),\ 32)}}
\DoxyCodeLine{00276\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00277\ \textcolor{comment}{//\ *\ out\ :\ [out]\ 32-\/byte\ record\ commitment.}}
\DoxyCodeLine{00278\ \textcolor{comment}{//\ *\ hdr\ :\ [in]\ \ record\ header\ fields.}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00280\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_compute\_record\_commit(uint8\_t\ out[UDIL\_HASHLEN],\ const\ udil\_record\_hdr*\ hdr);}}
\DoxyCodeLine{00281\ \textcolor{comment}{//}}
\DoxyCodeLine{00283\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Append\ an\ administrative\ reset\ record\ and\ transition\ the\ ledger\ to\ a\ new\ epoch.}}
\DoxyCodeLine{00284\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00285\ \textcolor{comment}{//\ *\ This\ function\ is\ used\ to\ record\ and\ justify\ a\ ledger\ reset\ event\ (for\ example,}}
\DoxyCodeLine{00286\ \textcolor{comment}{//\ *\ storage\ corruption,\ disaster\ recovery,\ or\ operator-\/directed\ reinitialization)}}
\DoxyCodeLine{00287\ \textcolor{comment}{//\ *\ while\ preserving\ audit\ continuity.}}
\DoxyCodeLine{00288\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00289\ \textcolor{comment}{//\ *\ A\ compliant\ implementation\ must:}}
\DoxyCodeLine{00290\ \textcolor{comment}{//\ *\ \ -\/\ Append\ an\ ADMIN\ record\ containing\ the\ reset\ reason\ and\ sufficient\ metadata}}
\DoxyCodeLine{00291\ \textcolor{comment}{//\ *\ \ \ \ to\ link\ the\ new\ epoch\ to\ the\ prior\ ledger\ state\ (for\ example,\ last\ checkpoint}}
\DoxyCodeLine{00292\ \textcolor{comment}{//\ *\ \ \ \ commitment\ and/or\ head\ commitment).}}
\DoxyCodeLine{00293\ \textcolor{comment}{//\ *\ \ -\/\ Increment\ the\ ledger\ epoch\ (or\ require\ the\ caller\ to\ do\ so\ explicitly,\ per\ spec).}}
\DoxyCodeLine{00294\ \textcolor{comment}{//\ *\ \ -\/\ Ensure\ that\ future\ checkpoints\ chain\ from\ the\ last\ known\ checkpoint\ commitment,}}
\DoxyCodeLine{00295\ \textcolor{comment}{//\ *\ \ \ \ preventing\ silent\ history\ deletion.}}
\DoxyCodeLine{00296\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00297\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00298\ \textcolor{comment}{//\ *\ \(\backslash\)param\ reset\_reason\ \ \ \ \ UTF-\/8\ or\ opaque\ bytes\ describing\ the\ reset\ reason.}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ *\ \(\backslash\)param\ reason\_len\ \ \ \ \ \ \ Length\ of\ reset\_reason\ in\ bytes.}}
\DoxyCodeLine{00300\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00301\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00302\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00303\ \textcolor{comment}{//int32\_t\ udil\_ledger\_admin\_reset(udil\_ledger\_state*\ st,\ const\ uint8\_t*\ reset\_reason,\ size\_t\ reason\_len);}}
\DoxyCodeLine{00304\ \textcolor{comment}{//}}
\DoxyCodeLine{00306\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Append\ a\ new\ record\ to\ the\ local\ evidence\ ledger.}}
\DoxyCodeLine{00307\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00308\ \textcolor{comment}{//\ *\ This\ function\ appends\ a\ new\ ledger\ record\ of\ the\ specified\ type,\ binding\ it\ to:}}
\DoxyCodeLine{00309\ \textcolor{comment}{//\ *\ \ -\/\ The\ current\ ledger\ head\ (via\ prev\_hash),}}
\DoxyCodeLine{00310\ \textcolor{comment}{//\ *\ \ -\/\ A\ monotonically\ increasing\ sequence\ number,}}
\DoxyCodeLine{00311\ \textcolor{comment}{//\ *\ \ -\/\ Optional\ envelope\ and\ payload\ commitments,}}
\DoxyCodeLine{00312\ \textcolor{comment}{//\ *\ \ -\/\ Optional\ correlation\ identifier,}}
\DoxyCodeLine{00313\ \textcolor{comment}{//\ *\ \ -\/\ Optional\ record\ body\ bytes.}}
\DoxyCodeLine{00314\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00315\ \textcolor{comment}{//\ *\ The\ record\ commitment\ is\ computed\ over\ the\ canonical\ serialized\ header\ fields}}
\DoxyCodeLine{00316\ \textcolor{comment}{//\ *\ and\ is\ then\ signed\ using\ the\ UDIF\ signing\ key\ carried\ in\ the\ ledger\ state.}}
\DoxyCodeLine{00317\ \textcolor{comment}{//\ *\ The\ storage\ backend\ is\ append-\/only,\ and\ the\ ledger\ head\ is\ updated\ on\ success.}}
\DoxyCodeLine{00318\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00319\ \textcolor{comment}{//\ *\ The\ function\ does\ not\ interpret\ message\ semantics.\ It\ stores\ evidence\ artifacts.}}
\DoxyCodeLine{00320\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00321\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00322\ \textcolor{comment}{//\ *\ \(\backslash\)param\ rtype\ \ \ \ \ \ \ \ \ \ \ \ Record\ type\ (message,\ ack,\ receipt,\ admin,\ etc.).}}
\DoxyCodeLine{00323\ \textcolor{comment}{//\ *\ \(\backslash\)param\ env\_hash\ \ \ \ \ \ \ \ \ Optional\ 32-\/byte\ envelope\ hash,\ may\ be\ NULL\ if\ unused\ by\ rtype.}}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ *\ \(\backslash\)param\ pay\_hash\ \ \ \ \ \ \ \ \ Optional\ 32-\/byte\ payload\ hash,\ may\ be\ NULL\ if\ unused\ by\ rtype.}}
\DoxyCodeLine{00325\ \textcolor{comment}{//\ *\ \(\backslash\)param\ corr\_id\ \ \ \ \ \ \ \ \ \ Optional\ 16-\/byte\ correlation\ id,\ may\ be\ NULL\ if\ unused.}}
\DoxyCodeLine{00326\ \textcolor{comment}{//\ *\ \(\backslash\)param\ body\ \ \ \ \ \ \ \ \ \ \ \ \ Optional\ record\ body\ bytes\ (opaque),\ may\ be\ NULL.}}
\DoxyCodeLine{00327\ \textcolor{comment}{//\ *\ \(\backslash\)param\ body\_len\ \ \ \ \ \ \ \ \ Length\ of\ body\ in\ bytes,\ may\ be\ 0.}}
\DoxyCodeLine{00328\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_rec\_commit\ \ \ Optional\ 32-\/byte\ output\ buffer\ receiving\ the\ computed\ record\ commitment.}}
\DoxyCodeLine{00329\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00330\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00331\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00332\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_append(udil\_ledger\_state*\ st,\ udil\_record\_type\ rtype,\ const\ uint8\_t\ env\_hash[UDIL\_HASHLEN],\ const\ uint8\_t\ pay\_hash[UDIL\_HASHLEN],}}
\DoxyCodeLine{00333\ \textcolor{comment}{//\ \ \ \ const\ uint8\_t\ corr\_id[16],\ const\ uint8\_t*\ body,\ size\_t\ body\_len,\ uint8\_t*\ out\_rec\_commit);}}
\DoxyCodeLine{00334\ \textcolor{comment}{//}}
\DoxyCodeLine{00336\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Append\ an\ external\ anchoring\ reference\ for\ a\ checkpoint\ commitment.}}
\DoxyCodeLine{00337\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00338\ \textcolor{comment}{//\ *\ This\ function\ records\ that\ a\ specific\ checkpoint\ commitment\ has\ been\ anchored}}
\DoxyCodeLine{00339\ \textcolor{comment}{//\ *\ to\ an\ external\ witness\ system\ (for\ example,\ a\ regulator-\/operated\ anchor,\ a}}
\DoxyCodeLine{00340\ \textcolor{comment}{//\ *\ consortium\ witness,\ or\ later\ a\ global\ provenance\ pillar).}}
\DoxyCodeLine{00341\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00342\ \textcolor{comment}{//\ *\ The\ anchor\ reference\ is\ evidence\ that\ a\ checkpoint\ existed\ at\ or\ before\ some}}
\DoxyCodeLine{00343\ \textcolor{comment}{//\ *\ externally\ attested\ point\ in\ time.\ The\ anchor\ mechanism\ itself\ is\ out\ of\ scope}}
\DoxyCodeLine{00344\ \textcolor{comment}{//\ *\ for\ the\ local\ ledger\ and\ is\ represented\ here\ only\ by\ an\ identifier\ (receipt\ id,}}
\DoxyCodeLine{00345\ \textcolor{comment}{//\ *\ transaction\ id\ hash,\ or\ equivalent).}}
\DoxyCodeLine{00346\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00347\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00348\ \textcolor{comment}{//\ *\ \(\backslash\)param\ a\ \ \ \ Anchor\ reference\ structure\ containing\ checkpoint\ commitment\ and\ witness\ identifier.}}
\DoxyCodeLine{00349\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00350\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00351\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00352\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_append\_anchor\_reference(udil\_ledger\_state*\ st,\ const\ udil\_anchor\_ref*\ a);}}
\DoxyCodeLine{00353\ \textcolor{comment}{//}}
\DoxyCodeLine{00355\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Construct\ a\ checkpoint\ body\ for\ a\ contiguous\ record\ range.}}
\DoxyCodeLine{00356\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00357\ \textcolor{comment}{//\ *\ This\ function\ computes\ the\ Merkle\ root\ over\ the\ sequence\ of\ record\ commitments}}
\DoxyCodeLine{00358\ \textcolor{comment}{//\ *\ for\ records\ in\ the\ inclusive\ range\ [start\_seq,\ end\_seq].\ It\ then\ populates\ a}}
\DoxyCodeLine{00359\ \textcolor{comment}{//\ *\ checkpoint\ body\ that\ binds:}}
\DoxyCodeLine{00360\ \textcolor{comment}{//\ *\ \ -\/\ ledger\_id\ and\ epoch,}}
\DoxyCodeLine{00361\ \textcolor{comment}{//\ *\ \ -\/\ the\ sequence\ range,}}
\DoxyCodeLine{00362\ \textcolor{comment}{//\ *\ \ -\/\ the\ record\ count,}}
\DoxyCodeLine{00363\ \textcolor{comment}{//\ *\ \ -\/\ the\ computed\ batch\ root,}}
\DoxyCodeLine{00364\ \textcolor{comment}{//\ *\ \ -\/\ the\ previous\ checkpoint\ commitment\ (for\ checkpoint\ chaining),}}
\DoxyCodeLine{00365\ \textcolor{comment}{//\ *\ \ -\/\ the\ checkpoint\ creation\ time.}}
\DoxyCodeLine{00366\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00367\ \textcolor{comment}{//\ *\ This\ function\ builds\ the\ checkpoint\ body\ only.\ Signing\ and\ appending\ the}}
\DoxyCodeLine{00368\ \textcolor{comment}{//\ *\ checkpoint\ is\ performed\ by\ udil\_ledger\_issue\_checkpoint().}}
\DoxyCodeLine{00369\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00370\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00371\ \textcolor{comment}{//\ *\ \(\backslash\)param\ start\_seq\ \ First\ record\ sequence\ number\ in\ the\ checkpoint\ batch\ (inclusive).}}
\DoxyCodeLine{00372\ \textcolor{comment}{//\ *\ \(\backslash\)param\ end\_seq\ \ \ \ Last\ record\ sequence\ number\ in\ the\ checkpoint\ batch\ (inclusive).}}
\DoxyCodeLine{00373\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_body\ \ \ Output\ checkpoint\ body\ structure.}}
\DoxyCodeLine{00374\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00375\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00376\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00377\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_build\_checkpoint\_body(udil\_ledger\_state*\ st,\ uint64\_t\ start\_seq,\ uint64\_t\ end\_seq,\ udil\_checkpoint\_body*\ out\_body);}}
\DoxyCodeLine{00378\ \textcolor{comment}{//}}
\DoxyCodeLine{00380\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Build\ a\ Merkle\ inclusion\ proof\ for\ a\ target\ record\ within\ a\ checkpoint\ range.}}
\DoxyCodeLine{00381\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00382\ \textcolor{comment}{//\ *\ This\ function\ produces\ an\ inclusion\ proof\ showing\ that\ the\ record\ at\ target\_seq}}
\DoxyCodeLine{00383\ \textcolor{comment}{//\ *\ is\ included\ in\ the\ Merkle\ root\ computed\ for\ the\ inclusive\ range\ [start\_seq,\ end\_seq].}}
\DoxyCodeLine{00384\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00385\ \textcolor{comment}{//\ *\ The\ proof\ contains\ sibling\ hashes\ and\ direction\ bits\ sufficient\ for\ an\ independent}}
\DoxyCodeLine{00386\ \textcolor{comment}{//\ *\ verifier\ to\ recompute\ the\ Merkle\ root\ from\ out\_rec\_commit\ and\ the\ proof,\ and\ compare}}
\DoxyCodeLine{00387\ \textcolor{comment}{//\ *\ it\ to\ out\_root\ (or\ to\ a\ checkpoint’s\ batch\_root).}}
\DoxyCodeLine{00388\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00389\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00390\ \textcolor{comment}{//\ *\ \(\backslash\)param\ start\_seq\ \ \ \ \ \ First\ record\ sequence\ number\ in\ the\ proof\ batch\ (inclusive).}}
\DoxyCodeLine{00391\ \textcolor{comment}{//\ *\ \(\backslash\)param\ end\_seq\ \ \ \ \ \ \ \ Last\ record\ sequence\ number\ in\ the\ proof\ batch\ (inclusive).}}
\DoxyCodeLine{00392\ \textcolor{comment}{//\ *\ \(\backslash\)param\ target\_seq\ \ \ \ \ Sequence\ number\ of\ the\ record\ to\ prove\ included.}}
\DoxyCodeLine{00393\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_proof\ \ \ \ \ \ Output\ Merkle\ proof\ structure.}}
\DoxyCodeLine{00394\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_rec\_commit\ Output\ 32-\/byte\ record\ commitment\ for\ target\_seq.}}
\DoxyCodeLine{00395\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_root\ \ \ \ \ \ \ Output\ 32-\/byte\ Merkle\ root\ for\ [start\_seq,\ end\_seq].}}
\DoxyCodeLine{00396\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00397\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00398\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00399\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_build\_inclusion\_proof(udil\_ledger\_state*\ st,\ uint64\_t\ start\_seq,\ uint64\_t\ end\_seq,\ uint64\_t\ target\_seq,}}
\DoxyCodeLine{00400\ \textcolor{comment}{//\ \ \ \ udil\_merkle\_proof*\ out\_proof,\ uint8\_t\ out\_rec\_commit[UDIL\_HASHLEN],\ uint8\_t\ out\_root[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00401\ \textcolor{comment}{//}}
\DoxyCodeLine{00403\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Initialize\ a\ ledger\ state\ and\ load\ persistent\ head\ and\ checkpoint\ state\ from\ storage.}}
\DoxyCodeLine{00404\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00405\ \textcolor{comment}{//\ *\ This\ function\ initializes\ the\ in-\/memory\ ledger\ state\ with\ its\ fixed\ identity\ and}}
\DoxyCodeLine{00406\ \textcolor{comment}{//\ *\ operational\ parameters,\ then\ synchronizes\ it\ with\ the\ persistent\ storage\ backend.}}
\DoxyCodeLine{00407\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00408\ \textcolor{comment}{//\ *\ A\ compliant\ implementation\ should:}}
\DoxyCodeLine{00409\ \textcolor{comment}{//\ *\ \ -\/\ Set\ ledger\_id\ and\ epoch.}}
\DoxyCodeLine{00410\ \textcolor{comment}{//\ *\ \ -\/\ Associate\ the\ UDIF\ signing\ key\ used\ for\ signing\ new\ records\ and\ checkpoints.}}
\DoxyCodeLine{00411\ \textcolor{comment}{//\ *\ \ -\/\ Associate\ the\ append-\/only\ storage\ backend.}}
\DoxyCodeLine{00412\ \textcolor{comment}{//\ *\ \ -\/\ Load\ the\ current\ head\ sequence\ and\ head\ commitment\ from\ storage,\ or\ set\ a}}
\DoxyCodeLine{00413\ \textcolor{comment}{//\ *\ \ \ \ genesis\ head\ if\ storage\ is\ empty.}}
\DoxyCodeLine{00414\ \textcolor{comment}{//\ *\ \ -\/\ Load\ the\ last\ checkpoint\ commitment\ and\ its\ end\ sequence\ if\ available.}}
\DoxyCodeLine{00415\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00416\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object\ to\ initialize.}}
\DoxyCodeLine{00417\ \textcolor{comment}{//\ *\ \(\backslash\)param\ ledger\_id\ \ \ \ \ \ \ \ Stable\ 32-\/byte\ identifier\ for\ this\ ledger\ instance.}}
\DoxyCodeLine{00418\ \textcolor{comment}{//\ *\ \(\backslash\)param\ epoch\ \ \ \ \ \ \ \ \ \ \ \ Epoch\ number\ (incremented\ on\ reset\ or\ signing-\/key\ rollover).}}
\DoxyCodeLine{00419\ \textcolor{comment}{//\ *\ \(\backslash\)param\ udif\_signing\_key\ Opaque\ handle\ to\ the\ UDIF\ signing\ key\ for\ this\ ledger.}}
\DoxyCodeLine{00420\ \textcolor{comment}{//\ *\ \(\backslash\)param\ store\ \ \ \ \ \ \ \ \ \ \ \ Opaque\ handle\ to\ the\ storage\ backend.}}
\DoxyCodeLine{00421\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00422\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00423\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00424\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_initialize(udil\_ledger\_state*\ st,\ const\ uint8\_t\ ledger\_id[UDIL\_HASHLEN],\ uint32\_t\ epoch,\ void*\ udif\_signing\_key,\ void*\ store);}}
\DoxyCodeLine{00425\ \textcolor{comment}{//}}
\DoxyCodeLine{00427\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Issue,\ sign,\ and\ append\ a\ checkpoint\ record\ to\ the\ ledger.}}
\DoxyCodeLine{00428\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00429\ \textcolor{comment}{//\ *\ This\ function\ creates\ a\ checkpoint\ for\ records\ in\ the\ inclusive\ range}}
\DoxyCodeLine{00430\ \textcolor{comment}{//\ *\ [start\_seq,\ end\_seq]\ and\ appends\ it\ as\ a\ checkpoint\ record\ to\ the\ ledger.}}
\DoxyCodeLine{00431\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00432\ \textcolor{comment}{//\ *\ A\ compliant\ implementation\ must:}}
\DoxyCodeLine{00433\ \textcolor{comment}{//\ *\ \ -\/\ Build\ the\ checkpoint\ body\ (udil\_ledger\_build\_checkpoint\_body()).}}
\DoxyCodeLine{00434\ \textcolor{comment}{//\ *\ \ -\/\ Compute\ the\ checkpoint\ commitment\ over\ the\ canonical\ body.}}
\DoxyCodeLine{00435\ \textcolor{comment}{//\ *\ \ -\/\ Sign\ the\ checkpoint\ commitment\ using\ the\ ledger’s\ UDIF\ signing\ key.}}
\DoxyCodeLine{00436\ \textcolor{comment}{//\ *\ \ -\/\ Append\ a\ CHECKPOINT\ record\ that\ contains\ the\ body\ and\ checkpoint\ signature.}}
\DoxyCodeLine{00437\ \textcolor{comment}{//\ *\ \ -\/\ Update\ the\ ledger\ state’s\ last\ checkpoint\ tracking\ values.}}
\DoxyCodeLine{00438\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00439\ \textcolor{comment}{//\ *\ The\ returned\ out\_chk\_commit\ is\ intended\ for\ external\ anchoring\ and\ for}}
\DoxyCodeLine{00440\ \textcolor{comment}{//\ *\ audit\ exchange.}}
\DoxyCodeLine{00441\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00442\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00443\ \textcolor{comment}{//\ *\ \(\backslash\)param\ start\_seq\ \ \ \ \ \ First\ record\ sequence\ number\ in\ the\ checkpoint\ batch\ (inclusive).}}
\DoxyCodeLine{00444\ \textcolor{comment}{//\ *\ \(\backslash\)param\ end\_seq\ \ \ \ \ \ \ \ Last\ record\ sequence\ number\ in\ the\ checkpoint\ batch\ (inclusive).}}
\DoxyCodeLine{00445\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_chk\_commit\ Output\ 32-\/byte\ checkpoint\ commitment.}}
\DoxyCodeLine{00446\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00447\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00448\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00449\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_issue\_checkpoint(udil\_ledger\_state*\ st,\ uint64\_t\ start\_seq,\ uint64\_t\ end\_seq,\ uint8\_t\ out\_chk\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00450\ \textcolor{comment}{//}}
\DoxyCodeLine{00452\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Parse\ a\ stored\ record\ blob\ into\ header,\ body,\ and\ signature\ components.}}
\DoxyCodeLine{00453\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00454\ \textcolor{comment}{//\ *\ This\ function\ decodes\ the\ record\ container\ format\ produced\ by\ udil\_ledger\_append()}}
\DoxyCodeLine{00455\ \textcolor{comment}{//\ *\ and\ returns:}}
\DoxyCodeLine{00456\ \textcolor{comment}{//\ *\ \ -\/\ the\ committed\ header\ fields,}}
\DoxyCodeLine{00457\ \textcolor{comment}{//\ *\ \ -\/\ the\ optional\ opaque\ body\ bytes,}}
\DoxyCodeLine{00458\ \textcolor{comment}{//\ *\ \ -\/\ the\ signature\ bytes.}}
\DoxyCodeLine{00459\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00460\ \textcolor{comment}{//\ *\ The\ caller\ owns\ the\ returned\ out\_body\ and\ out\_sig\ buffers\ and\ must\ free\ them}}
\DoxyCodeLine{00461\ \textcolor{comment}{//\ *\ using\ the\ allocator\ compatible\ with\ the\ implementation.}}
\DoxyCodeLine{00462\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00463\ \textcolor{comment}{//\ *\ This\ function\ does\ not\ verify\ signatures.\ Use\ udil\_ledger\_verify\_record\_blob()}}
\DoxyCodeLine{00464\ \textcolor{comment}{//\ *\ for\ verification.}}
\DoxyCodeLine{00465\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00466\ \textcolor{comment}{//\ *\ \(\backslash\)param\ blob\ \ \ \ \ \ \ \ \ Raw\ stored\ record\ blob\ bytes.}}
\DoxyCodeLine{00467\ \textcolor{comment}{//\ *\ \(\backslash\)param\ blob\_len\ \ \ \ \ Length\ of\ blob\ in\ bytes.}}
\DoxyCodeLine{00468\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_hdr\ \ \ \ \ \ Output\ parsed\ record\ header.}}
\DoxyCodeLine{00469\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_body\ \ \ \ \ Output\ pointer\ to\ allocated\ body\ bytes\ (may\ be\ NULL\ if\ no\ body).}}
\DoxyCodeLine{00470\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_body\_len\ Output\ body\ length\ (0\ if\ no\ body).}}
\DoxyCodeLine{00471\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_sig\ \ \ \ \ \ Output\ pointer\ to\ allocated\ signature\ bytes.}}
\DoxyCodeLine{00472\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_sig\_len\ \ Output\ signature\ length.}}
\DoxyCodeLine{00473\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00474\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00475\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00476\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_parse\_record(const\ uint8\_t*\ blob,\ size\_t\ blob\_len,\ udil\_record\_hdr*\ out\_hdr,\ uint8\_t**\ out\_body,}}
\DoxyCodeLine{00477\ \textcolor{comment}{//\ \ \ \ size\_t*\ out\_body\_len,\ uint8\_t**\ out\_sig,\ size\_t*\ out\_sig\_len);}}
\DoxyCodeLine{00478\ \textcolor{comment}{//}}
\DoxyCodeLine{00480\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Rotate\ the\ UDIF\ signing\ key\ used\ by\ the\ ledger\ and\ transition\ to\ a\ new\ epoch.}}
\DoxyCodeLine{00481\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00482\ \textcolor{comment}{//\ *\ This\ function\ updates\ the\ ledger’s\ signing\ key\ to\ a\ new\ UDIF\ key\ and\ increments}}
\DoxyCodeLine{00483\ \textcolor{comment}{//\ *\ the\ epoch\ to\ explicitly\ mark\ the\ key\ transition\ in\ the\ evidentiary\ record.}}
\DoxyCodeLine{00484\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00485\ \textcolor{comment}{//\ *\ A\ compliant\ implementation\ should:}}
\DoxyCodeLine{00486\ \textcolor{comment}{//\ *\ \ -\/\ Update\ st-\/>udif\_signing\_key\ to\ new\_udif\_signing\_key.}}
\DoxyCodeLine{00487\ \textcolor{comment}{//\ *\ \ -\/\ Increment\ st-\/>epoch.}}
\DoxyCodeLine{00488\ \textcolor{comment}{//\ *\ \ -\/\ Preserve\ continuity\ by\ issuing\ a\ checkpoint\ over\ any\ uncheckpointed\ records}}
\DoxyCodeLine{00489\ \textcolor{comment}{//\ *\ \ \ \ prior\ to\ completing\ the\ rollover\ (policy\ dependent,\ but\ recommended).}}
\DoxyCodeLine{00490\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00491\ \textcolor{comment}{//\ *\ \(\backslash\)param\ st\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Ledger\ state\ object.}}
\DoxyCodeLine{00492\ \textcolor{comment}{//\ *\ \(\backslash\)param\ new\_udif\_signing\_key\ Opaque\ handle\ to\ the\ new\ UDIF\ signing\ key.}}
\DoxyCodeLine{00493\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00494\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00495\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00496\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_rotate\_key(udil\_ledger\_state*\ st,\ void*\ new\_udif\_signing\_key);}}
\DoxyCodeLine{00497\ \textcolor{comment}{//}}
\DoxyCodeLine{00499\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Verify\ a\ stored\ record\ blob\ signature\ and\ recompute\ its\ record\ commitment.}}
\DoxyCodeLine{00500\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00501\ \textcolor{comment}{//\ *\ This\ function\ parses\ the\ record\ blob,\ recomputes\ the\ record\ commitment\ from\ the}}
\DoxyCodeLine{00502\ \textcolor{comment}{//\ *\ committed\ header\ fields,\ and\ verifies\ that\ the\ signature\ over\ the\ record\ commitment}}
\DoxyCodeLine{00503\ \textcolor{comment}{//\ *\ is\ valid\ under\ the\ supplied\ signer\ certificate.}}
\DoxyCodeLine{00504\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00505\ \textcolor{comment}{//\ *\ The\ output\ record\ commitment\ can\ be\ used\ as\ an\ input\ leaf\ to\ checkpoint\ Merkle\ trees}}
\DoxyCodeLine{00506\ \textcolor{comment}{//\ *\ and\ as\ an\ evidentiary\ identifier\ for\ the\ record.}}
\DoxyCodeLine{00507\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00508\ \textcolor{comment}{//\ *\ \(\backslash\)param\ blob\ \ \ \ \ \ \ \ \ \ \ Raw\ stored\ record\ blob\ bytes.}}
\DoxyCodeLine{00509\ \textcolor{comment}{//\ *\ \(\backslash\)param\ blob\_len\ \ \ \ \ \ \ Length\ of\ blob\ in\ bytes.}}
\DoxyCodeLine{00510\ \textcolor{comment}{//\ *\ \(\backslash\)param\ signer\_cert\ \ \ \ The\ signer’s\ UDIF\ certificate\ bytes\ used\ for\ verification.}}
\DoxyCodeLine{00511\ \textcolor{comment}{//\ *\ \(\backslash\)param\ cert\_len\ \ \ \ \ \ \ Length\ of\ signer\_cert\ in\ bytes.}}
\DoxyCodeLine{00512\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_rec\_commit\ Output\ 32-\/byte\ record\ commitment.}}
\DoxyCodeLine{00513\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00514\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ on\ success\ (signature\ valid),\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00515\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00516\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_verify\_record\_blob(const\ uint8\_t*\ blob,\ size\_t\ blob\_len,\ const\ uint8\_t*\ signer\_cert,\ size\_t\ cert\_len,\ uint8\_t\ out\_rec\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00517\ \textcolor{comment}{//}}
\DoxyCodeLine{00519\ \textcolor{comment}{//\ *\ Compute\ the\ Merkle\ leaf\ node\ hash\ from\ a\ record\ commitment.}}
\DoxyCodeLine{00520\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00521\ \textcolor{comment}{//\ *\ leaf\ =\ SHAKE256("{}UDIL/LEAF"{}\ ||\ rec\_commit,\ 32)}}
\DoxyCodeLine{00522\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00523\ \textcolor{comment}{//\ *\ out\ \ \ \ \ \ \ \ :\ [out]\ 32-\/byte\ leaf\ hash.}}
\DoxyCodeLine{00524\ \textcolor{comment}{//\ *\ rec\_commit\ :\ [in]\ \ 32-\/byte\ record\ commitment.}}
\DoxyCodeLine{00525\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00526\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_merkle\_leaf(uint8\_t\ out[UDIL\_HASHLEN],\ const\ uint8\_t\ rec\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00527\ \textcolor{comment}{//}}
\DoxyCodeLine{00529\ \textcolor{comment}{//\ *\ Compute\ the\ Merkle\ parent\ node\ hash.}}
\DoxyCodeLine{00530\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00531\ \textcolor{comment}{//\ *\ parent\ =\ SHAKE256("{}UDIL/NODE"{}\ ||\ left\ ||\ right,\ 32)}}
\DoxyCodeLine{00532\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00533\ \textcolor{comment}{//\ *\ out\ \ \ :\ [out]\ 32-\/byte\ parent\ hash.}}
\DoxyCodeLine{00534\ \textcolor{comment}{//\ *\ left\ \ :\ [in]\ \ 32-\/byte\ left\ child.}}
\DoxyCodeLine{00535\ \textcolor{comment}{//\ *\ right\ :\ [in]\ \ 32-\/byte\ right\ child.}}
\DoxyCodeLine{00536\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00537\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_merkle\_parent(uint8\_t\ out[UDIL\_HASHLEN],\ const\ uint8\_t\ left[UDIL\_HASHLEN],\ const\ uint8\_t\ right[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00538\ \textcolor{comment}{//}}
\DoxyCodeLine{00540\ \textcolor{comment}{//\ *\ Verify\ a\ Merkle\ inclusion\ proof\ and\ recompute\ the\ root.}}
\DoxyCodeLine{00541\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00542\ \textcolor{comment}{//\ *\ out\_root\ \ \ :\ [out]\ computed\ Merkle\ root\ from\ the\ proof.}}
\DoxyCodeLine{00543\ \textcolor{comment}{//\ *\ rec\_commit\ :\ [in]\ \ record\ commitment\ being\ proven.}}
\DoxyCodeLine{00544\ \textcolor{comment}{//\ *\ proof\ \ \ \ \ \ :\ [in]\ \ inclusion\ proof\ (siblings\ +\ directions).}}
\DoxyCodeLine{00545\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00546\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_merkle\_verify(uint8\_t\ out\_root[UDIL\_HASHLEN],\ const\ uint8\_t\ rec\_commit[UDIL\_HASHLEN],\ const\ udil\_merkle\_proof*\ proof);}}
\DoxyCodeLine{00547\ \textcolor{comment}{//}}
\DoxyCodeLine{00549\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Compute\ the\ Merkle\ root\ over\ a\ contiguous\ set\ of\ record\ commitments.}}
\DoxyCodeLine{00550\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00551\ \textcolor{comment}{//\ *\ This\ function\ computes\ a\ deterministic\ Merkle\ root\ using\ the\ UDIL\ Merkle}}
\DoxyCodeLine{00552\ \textcolor{comment}{//\ *\ construction\ rules:}}
\DoxyCodeLine{00553\ \textcolor{comment}{//\ *\ \ -\/\ Each\ record\ commitment\ is\ first\ transformed\ into\ a\ Merkle\ leaf.}}
\DoxyCodeLine{00554\ \textcolor{comment}{//\ *\ \ -\/\ Parent\ nodes\ are\ computed\ pairwise\ from\ left\ and\ right\ children.}}
\DoxyCodeLine{00555\ \textcolor{comment}{//\ *\ \ -\/\ If\ a\ level\ has\ an\ odd\ number\ of\ nodes,\ the\ final\ node\ is\ duplicated.}}
\DoxyCodeLine{00556\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00557\ \textcolor{comment}{//\ *\ The\ resulting\ root\ is\ suitable\ for\ inclusion\ in\ a\ checkpoint\ body\ and}}
\DoxyCodeLine{00558\ \textcolor{comment}{//\ *\ for\ later\ audit\ verification\ using\ Merkle\ inclusion\ proofs.}}
\DoxyCodeLine{00559\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00560\ \textcolor{comment}{//\ *\ \(\backslash\)param\ root\ \ \ \ \ \ \ \ Output\ buffer\ receiving\ the\ computed\ Merkle\ root.}}
\DoxyCodeLine{00561\ \textcolor{comment}{//\ *\ \(\backslash\)param\ rec\_commits\ Pointer\ to\ a\ flat\ array\ of\ record\ commitments}}
\DoxyCodeLine{00562\ \textcolor{comment}{//\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (count\ *\ UDIL\_HASHLEN\ bytes).}}
\DoxyCodeLine{00563\ \textcolor{comment}{//\ *\ \(\backslash\)param\ count\ \ \ \ \ \ \ Number\ of\ record\ commitments\ in\ the\ array.}}
\DoxyCodeLine{00564\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00565\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_merkle\_root(uint8\_t\ root[UDIL\_HASHLEN],\ const\ uint8\_t*\ rec\_commits,\ size\_t\ count);}}
\DoxyCodeLine{00566\ \textcolor{comment}{//}}
\DoxyCodeLine{00568\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Serialize\ an\ anchor\ reference\ into\ canonical\ byte\ form.}}
\DoxyCodeLine{00569\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00570\ \textcolor{comment}{//\ *\ This\ function\ serializes\ an\ \(\backslash\)c\ udil\_anchor\_ref\ structure\ into\ its\ canonical}}
\DoxyCodeLine{00571\ \textcolor{comment}{//\ *\ binary\ representation.\ The\ serialized\ output\ is\ suitable\ for\ inclusion\ as}}
\DoxyCodeLine{00572\ \textcolor{comment}{//\ *\ the\ body\ of\ an\ ANCHOR\_REFERENCE\ ledger\ record.}}
\DoxyCodeLine{00573\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00574\ \textcolor{comment}{//\ *\ The\ caller\ owns\ the\ returned\ buffer\ and\ must\ free\ it\ using\ the\ allocator}}
\DoxyCodeLine{00575\ \textcolor{comment}{//\ *\ compatible\ with\ the\ implementation.}}
\DoxyCodeLine{00576\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00577\ \textcolor{comment}{//\ *\ \(\backslash\)param\ a\ \ \ \ \ \ \ \ Anchor\ reference\ structure\ to\ serialize.}}
\DoxyCodeLine{00578\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_len\ Output\ parameter\ receiving\ the\ serialized\ length\ in\ bytes.}}
\DoxyCodeLine{00579\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00580\ \textcolor{comment}{//\ *\ \(\backslash\)return\ Pointer\ to\ a\ newly\ allocated\ buffer\ containing\ the\ serialized}}
\DoxyCodeLine{00581\ \textcolor{comment}{//\ *\ \ \ \ \ \ \ \ \ anchor\ reference,\ or\ NULL\ on\ failure.}}
\DoxyCodeLine{00582\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00583\ \textcolor{comment}{//UDIL\_EXPORT\_API\ uint8\_t*\ udil\_serialize\_anchor\_reference(const\ udil\_anchor\_ref*\ a,\ size\_t*\ out\_len);}}
\DoxyCodeLine{00584\ \textcolor{comment}{//}}
\DoxyCodeLine{00586\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Serialize\ a\ checkpoint\ body\ into\ canonical\ byte\ form.}}
\DoxyCodeLine{00587\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00588\ \textcolor{comment}{//\ *\ This\ function\ serializes\ an\ \(\backslash\)c\ udil\_checkpoint\_body\ structure\ into\ the\ exact}}
\DoxyCodeLine{00589\ \textcolor{comment}{//\ *\ canonical\ format\ used\ for\ computing\ checkpoint\ commitments\ and\ signatures.}}
\DoxyCodeLine{00590\ \textcolor{comment}{//\ *\ The\ serialization\ includes\ all\ committed\ fields\ in\ fixed\ order\ and}}
\DoxyCodeLine{00591\ \textcolor{comment}{//\ *\ big-\/endian\ encoding\ for\ multi-\/byte\ integers.}}
\DoxyCodeLine{00592\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00593\ \textcolor{comment}{//\ *\ The\ returned\ buffer\ is\ used\ as\ input\ to\ the\ checkpoint\ commitment\ hash}}
\DoxyCodeLine{00594\ \textcolor{comment}{//\ *\ function.}}
\DoxyCodeLine{00595\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00596\ \textcolor{comment}{//\ *\ The\ caller\ owns\ the\ returned\ buffer\ and\ must\ free\ it\ when\ no\ longer\ needed.}}
\DoxyCodeLine{00597\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00598\ \textcolor{comment}{//\ *\ \(\backslash\)param\ c\ \ \ \ \ \ \ \ Checkpoint\ body\ structure\ to\ serialize.}}
\DoxyCodeLine{00599\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_len\ Output\ parameter\ receiving\ the\ serialized\ length\ in\ bytes.}}
\DoxyCodeLine{00600\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00601\ \textcolor{comment}{//\ *\ \(\backslash\)return\ Pointer\ to\ a\ newly\ allocated\ buffer\ containing\ the\ serialized}}
\DoxyCodeLine{00602\ \textcolor{comment}{//\ *\ \ \ \ \ \ \ \ \ checkpoint\ body,\ or\ NULL\ on\ failure.}}
\DoxyCodeLine{00603\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00604\ \textcolor{comment}{//UDIL\_EXPORT\_API\ uint8\_t*\ udil\_serialize\_checkpoint\_body(const\ udil\_checkpoint\_body*\ c,\ size\_t*\ out\_len);}}
\DoxyCodeLine{00605\ \textcolor{comment}{//}}
\DoxyCodeLine{00607\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Serialize\ a\ record\ header\ into\ canonical\ byte\ form.}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00609\ \textcolor{comment}{//\ *\ This\ function\ serializes\ the\ committed\ fields\ of\ an\ \(\backslash\)c\ udil\_record\_hdr\ into}}
\DoxyCodeLine{00610\ \textcolor{comment}{//\ *\ a\ canonical\ binary\ representation.\ The\ output\ is\ used\ exclusively\ for}}
\DoxyCodeLine{00611\ \textcolor{comment}{//\ *\ computing\ the\ record\ commitment\ hash.}}
\DoxyCodeLine{00612\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00613\ \textcolor{comment}{//\ *\ Signature\ bytes,\ variable-\/length\ bodies,\ and\ container\ framing\ are\ not}}
\DoxyCodeLine{00614\ \textcolor{comment}{//\ *\ included\ in\ this\ serialization.}}
\DoxyCodeLine{00615\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00616\ \textcolor{comment}{//\ *\ The\ caller\ owns\ the\ returned\ buffer\ and\ must\ free\ it\ when\ finished.}}
\DoxyCodeLine{00617\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00618\ \textcolor{comment}{//\ *\ \(\backslash\)param\ h\ \ \ \ \ \ \ \ Record\ header\ structure\ to\ serialize.}}
\DoxyCodeLine{00619\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_len\ Output\ parameter\ receiving\ the\ serialized\ length\ in\ bytes.}}
\DoxyCodeLine{00620\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00621\ \textcolor{comment}{//\ *\ \(\backslash\)return\ Pointer\ to\ a\ newly\ allocated\ buffer\ containing\ the\ serialized}}
\DoxyCodeLine{00622\ \textcolor{comment}{//\ *\ \ \ \ \ \ \ \ \ record\ header,\ or\ NULL\ on\ failure.}}
\DoxyCodeLine{00623\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00624\ \textcolor{comment}{//UDIL\_EXPORT\_API\ uint8\_t*\ udil\_serialize\_record\_header(const\ udil\_record\_hdr*\ h,\ size\_t*\ out\_len);}}
\DoxyCodeLine{00625\ \textcolor{comment}{//}}
\DoxyCodeLine{00627\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Sign\ a\ checkpoint\ commitment\ using\ a\ UDIF\ signing\ key.}}
\DoxyCodeLine{00628\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00629\ \textcolor{comment}{//\ *\ This\ function\ produces\ a\ cryptographic\ signature\ over\ a\ checkpoint}}
\DoxyCodeLine{00630\ \textcolor{comment}{//\ *\ commitment.\ The\ commitment\ must\ already\ have\ been\ computed\ from\ a\ canonical}}
\DoxyCodeLine{00631\ \textcolor{comment}{//\ *\ checkpoint\ body.}}
\DoxyCodeLine{00632\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00633\ \textcolor{comment}{//\ *\ The\ signature\ binds\ the\ issuing\ authority,\ the\ checkpoint\ content,\ and\ the}}
\DoxyCodeLine{00634\ \textcolor{comment}{//\ *\ signing\ context,\ providing\ non-\/repudiable\ evidence\ that\ the\ checkpoint\ was}}
\DoxyCodeLine{00635\ \textcolor{comment}{//\ *\ issued\ by\ the\ holder\ of\ the\ UDIF\ key.}}
\DoxyCodeLine{00636\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00637\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_sig\ \ \ \ \ Output\ buffer\ receiving\ the\ signature\ bytes.}}
\DoxyCodeLine{00638\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_siglen\ \ Output\ parameter\ receiving\ the\ signature\ length\ in\ bytes.}}
\DoxyCodeLine{00639\ \textcolor{comment}{//\ *\ \(\backslash\)param\ udif\_key\ \ \ \ Opaque\ handle\ to\ the\ UDIF\ signing\ key.}}
\DoxyCodeLine{00640\ \textcolor{comment}{//\ *\ \(\backslash\)param\ chk\_commit\ \ 32-\/byte\ checkpoint\ commitment\ to\ be\ signed.}}
\DoxyCodeLine{00641\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00642\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_sign\_checkpoint(uint8\_t*\ out\_sig,\ size\_t*\ out\_siglen,\ void*\ udif\_key,\ const\ uint8\_t\ chk\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00643\ \textcolor{comment}{//}}
\DoxyCodeLine{00645\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Sign\ a\ record\ commitment\ using\ a\ UDIF\ signing\ key.}}
\DoxyCodeLine{00646\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00647\ \textcolor{comment}{//\ *\ This\ function\ produces\ a\ cryptographic\ signature\ over\ a\ record\ commitment.}}
\DoxyCodeLine{00648\ \textcolor{comment}{//\ *\ The\ record\ commitment\ must\ already\ have\ been\ computed\ from\ the\ canonical}}
\DoxyCodeLine{00649\ \textcolor{comment}{//\ *\ record\ header\ serialization.}}
\DoxyCodeLine{00650\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00651\ \textcolor{comment}{//\ *\ The\ resulting\ signature\ provides\ non-\/repudiation\ for\ the\ existence\ and}}
\DoxyCodeLine{00652\ \textcolor{comment}{//\ *\ ordering\ of\ the\ record\ within\ the\ ledger.}}
\DoxyCodeLine{00653\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00654\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_sig\ \ \ \ \ Output\ buffer\ receiving\ the\ signature\ bytes.}}
\DoxyCodeLine{00655\ \textcolor{comment}{//\ *\ \(\backslash\)param\ out\_siglen\ \ Output\ parameter\ receiving\ the\ signature\ length\ in\ bytes.}}
\DoxyCodeLine{00656\ \textcolor{comment}{//\ *\ \(\backslash\)param\ udif\_key\ \ \ \ Opaque\ handle\ to\ the\ UDIF\ signing\ key.}}
\DoxyCodeLine{00657\ \textcolor{comment}{//\ *\ \(\backslash\)param\ rec\_commit\ \ 32-\/byte\ record\ commitment\ to\ be\ signed.}}
\DoxyCodeLine{00658\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00659\ \textcolor{comment}{//UDIL\_EXPORT\_API\ void\ udil\_sign\_record(uint8\_t\ out\_sig[],\ size\_t*\ out\_siglen,\ void*\ udif\_key,\ const\ uint8\_t\ rec\_commit[UDIL\_HASHLEN]);}}
\DoxyCodeLine{00660\ \textcolor{comment}{//}}
\DoxyCodeLine{00662\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Verify\ a\ checkpoint\ signature\ against\ a\ checkpoint\ commitment.}}
\DoxyCodeLine{00663\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00664\ \textcolor{comment}{//\ *\ This\ function\ verifies\ that\ a\ provided\ signature\ is\ a\ valid\ signature\ over}}
\DoxyCodeLine{00665\ \textcolor{comment}{//\ *\ the\ given\ checkpoint\ commitment\ under\ the\ supplied\ UDIF\ certificate.}}
\DoxyCodeLine{00666\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00667\ \textcolor{comment}{//\ *\ This\ verification\ step\ is\ required\ for:}}
\DoxyCodeLine{00668\ \textcolor{comment}{//\ *\ \ -\/\ Audit\ acceptance\ of\ a\ checkpoint.}}
\DoxyCodeLine{00669\ \textcolor{comment}{//\ *\ \ -\/\ Detection\ of\ forged\ or\ unauthorized\ checkpoints.}}
\DoxyCodeLine{00670\ \textcolor{comment}{//\ *\ \ -\/\ Establishing\ evidentiary\ validity\ of\ ledger\ checkpoints.}}
\DoxyCodeLine{00671\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00672\ \textcolor{comment}{//\ *\ \(\backslash\)param\ cert\ \ \ \ \ \ \ \ UDIF\ certificate\ bytes\ of\ the\ purported\ signer.}}
\DoxyCodeLine{00673\ \textcolor{comment}{//\ *\ \(\backslash\)param\ cert\_len\ \ \ \ Length\ of\ the\ certificate\ in\ bytes.}}
\DoxyCodeLine{00674\ \textcolor{comment}{//\ *\ \(\backslash\)param\ chk\_commit\ \ 32-\/byte\ checkpoint\ commitment\ that\ was\ signed.}}
\DoxyCodeLine{00675\ \textcolor{comment}{//\ *\ \(\backslash\)param\ sig\ \ \ \ \ \ \ \ \ Signature\ bytes\ to\ verify.}}
\DoxyCodeLine{00676\ \textcolor{comment}{//\ *\ \(\backslash\)param\ siglen\ \ \ \ \ \ Length\ of\ the\ signature\ in\ bytes.}}
\DoxyCodeLine{00677\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00678\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ if\ the\ signature\ is\ valid,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00679\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00680\ \textcolor{comment}{//int32\_t\ udil\_verify\_checkpoint\_signature(const\ uint8\_t*\ cert,\ size\_t\ cert\_len,\ const\ uint8\_t\ chk\_commit[UDIL\_HASHLEN],\ const\ uint8\_t*\ sig,\ size\_t\ siglen);}}
\DoxyCodeLine{00681\ \textcolor{comment}{//}}
\DoxyCodeLine{00683\ \textcolor{comment}{//\ *\ \(\backslash\)brief\ Verify\ a\ record\ signature\ against\ a\ record\ commitment.}}
\DoxyCodeLine{00684\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00685\ \textcolor{comment}{//\ *\ This\ function\ verifies\ that\ a\ provided\ signature\ is\ a\ valid\ signature\ over}}
\DoxyCodeLine{00686\ \textcolor{comment}{//\ *\ the\ given\ record\ commitment\ under\ the\ supplied\ UDIF\ certificate.}}
\DoxyCodeLine{00687\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00688\ \textcolor{comment}{//\ *\ Successful\ verification\ proves\ that\ the\ record\ was\ authorized\ by\ the}}
\DoxyCodeLine{00689\ \textcolor{comment}{//\ *\ certificate\ holder\ and\ that\ the\ committed\ record\ header\ has\ not\ been}}
\DoxyCodeLine{00690\ \textcolor{comment}{//\ *\ altered.}}
\DoxyCodeLine{00691\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00692\ \textcolor{comment}{//\ *\ \(\backslash\)param\ cert\ \ \ \ \ \ \ \ UDIF\ certificate\ bytes\ of\ the\ purported\ signer.}}
\DoxyCodeLine{00693\ \textcolor{comment}{//\ *\ \(\backslash\)param\ cert\_len\ \ \ \ Length\ of\ the\ certificate\ in\ bytes.}}
\DoxyCodeLine{00694\ \textcolor{comment}{//\ *\ \(\backslash\)param\ rec\_commit\ \ 32-\/byte\ record\ commitment\ that\ was\ signed.}}
\DoxyCodeLine{00695\ \textcolor{comment}{//\ *\ \(\backslash\)param\ sig\ \ \ \ \ \ \ \ \ Signature\ bytes\ to\ verify.}}
\DoxyCodeLine{00696\ \textcolor{comment}{//\ *\ \(\backslash\)param\ siglen\ \ \ \ \ \ Length\ of\ the\ signature\ in\ bytes.}}
\DoxyCodeLine{00697\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00698\ \textcolor{comment}{//\ *\ \(\backslash\)return\ 0\ if\ the\ signature\ is\ valid,\ otherwise\ a\ negative\ error\ code.}}
\DoxyCodeLine{00699\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00700\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_verify\_record\_signature(const\ uint8\_t*\ cert,\ size\_t\ cert\_len,\ const\ uint8\_t\ rec\_commit[UDIL\_HASHLEN],\ const\ uint8\_t*\ sig,\ size\_t\ siglen);}}
\DoxyCodeLine{00701\ \textcolor{comment}{//}}
\DoxyCodeLine{00703\ \textcolor{comment}{//\ *\ Simple\ UDIL\ Ledger\ Smoke\ Test}}
\DoxyCodeLine{00704\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00705\ \textcolor{comment}{//\ *\ This\ function\ performs\ a\ minimal\ end\ to\ end\ validation\ of\ the\ ledger:}}
\DoxyCodeLine{00706\ \textcolor{comment}{//\ *\ \ -\/\ initialize\ ledger}}
\DoxyCodeLine{00707\ \textcolor{comment}{//\ *\ \ -\/\ append\ a\ record}}
\DoxyCodeLine{00708\ \textcolor{comment}{//\ *\ \ -\/\ read\ the\ record\ back}}
\DoxyCodeLine{00709\ \textcolor{comment}{//\ *\ \ -\/\ recompute\ and\ verify\ the\ record\ commitment\ and\ signature}}
\DoxyCodeLine{00710\ \textcolor{comment}{//\ *}}
\DoxyCodeLine{00711\ \textcolor{comment}{//\ *\ This\ is\ intended\ as\ a\ basic\ sanity\ test,\ not\ a\ full\ audit\ test.}}
\DoxyCodeLine{00712\ \textcolor{comment}{//\ *\ It\ assumes\ that\ the\ storage\ backend\ and\ UDIF\ sign/verify\ primitives}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ *\ are\ already\ wired\ and\ functional.}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00715\ \textcolor{comment}{//UDIL\_EXPORT\_API\ int32\_t\ udil\_ledger\_basic\_selftest(udil\_ledger\_state*\ st,\ const\ uint8\_t\ ledger\_id[UDIL\_HASHLEN],\ void*\ udif\_signing\_key,\ void*\ store,\ const\ uint8\_t*\ signer\_cert,\ size\_t\ cert\_len);}}
\DoxyCodeLine{00716\ \textcolor{comment}{//}}
\DoxyCodeLine{00717\ \textcolor{comment}{//UDIL\_EXPORT\_API\ bool\ udil\_ledger\_selftest();}}
\DoxyCodeLine{00718\ }
\DoxyCodeLine{00719\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
